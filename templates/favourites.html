{% extends "layout.html" %}

{% block content %}
<div class="favourites">
    <div class="me red-border">
                <p class="favourites-header">What I Love About You</p>
                <div class="note-container green-border">

                    {% for note in favourites if note['created_by'] == 'Yassin' %}
                        {% set content = note['content'] %}
                        {% set title = note['content'] | truncate(20,true) %}
                        {% set date = note['date_created'] %}
                        
                        <button class="note red-border" onclick="showPopup('{{title}}','{{content}}','{{date}}')">{{title}}</button>
                    {% endfor %}
                    
                </div>
                
               

                    
          
       
    </div>
    <img src="/static/images/heart.svg" alt="Heart" width="117px" height="107px" id="heart-seperator">
    <div class="her green-border">
        <p class="favourites-header">What You Love About Me </p>
        
        <div class="note-container red-border">

            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
        </div>
            
          
     
    </div>
    
</div>


<div class="note-popup">
    <div class="note-popup-container">
        <img src="/static/Close.svg" width="30px" height="30px" onclick="hidePopup()" alt="">
    </div>
</div>
<div class="full-blur">

</div>
<script>
    const notePopup = document.getElementsByClassName("note-popup")[0]
    const fullBlur = document.getElementsByClassName("full-blur")[0]
    const notePopupContainer = document.getElementsByClassName('note-popup-container')[0]
    const noteContent = document.createElement('p')
    const noteDate = document.createElement('p')
    noteDate.classList.add("note-popup-date")
    noteContent.classList.add("note-popup-content")

    function showPopup(title,content,date) {
        noteContent.innerHTML = "" // Resetting the text incase this isn't the first popup to be opened.
        noteContent.innerText = content
        noteDate.innerHTML = ""
        noteDate.innerText = date
        console.log(title)
        console.log(content)
        console.log(date)
        notePopup.style.display = "block"
        fullBlur.style.display = "block"
        notePopupContainer.appendChild(noteContent)
        notePopupContainer.appendChild(noteDate)
    }

    // TODO: Modify the mongoDB database so that it stores titles
    // TODO: Create the form for her to add new entries
    


    function hidePopup() {
        console.log("closed")
        notePopup.style.display = "none"
        fullBlur.style.display = "none"
    }



    // Function to randomly place notes within their containers
// Function to randomly place notes within their containers with some spacing
function randomlyPlaceNotes() {
    const containers = document.querySelectorAll('.note-container');

    containers.forEach(container => {
        const containerWidth = container.offsetWidth;
        const containerHeight = container.offsetHeight;
        const notes = container.querySelectorAll('.note');
        const placedNotes = []; // Keep track of placed note positions

        notes.forEach(note => {
            note.style.position = 'absolute'; // Ensure notes are positioned freely
            let randomTop, randomLeft, tooClose;

            do {
                // Generate random top and left positions within container bounds
                randomTop = Math.random() * (containerHeight - note.offsetHeight);
                randomLeft = Math.random() * (containerWidth - note.offsetWidth);

                // Check if the new position is too close to any placed notes
                tooClose = placedNotes.some(placedNote => {
                    const distance = Math.sqrt(
                        Math.pow(placedNote.top - randomTop, 2) + Math.pow(placedNote.left - randomLeft, 2)
                    );
                    return distance < 130; // Minimum distance of 100px
                });
            } while (tooClose); // Repeat if position is too close to others

            // Apply the position to the note
            note.style.top = `${randomTop}px`;
            note.style.left = `${randomLeft}px`;

            // Save this note's position to placedNotes
            placedNotes.push({ top: randomTop, left: randomLeft });
        });
    });
}

// Call the function when the page loads
window.onload = randomlyPlaceNotes;

</script>



{% endblock %}



